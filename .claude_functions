# >>> claude-dotfiles >>>
# Claude Code helpers for Codespaces

clauded() {
  local repo=$(basename "$(git rev-parse --show-toplevel 2>/dev/null)" 2>/dev/null || echo "no-repo")
  local branch=$(git branch --show-current 2>/dev/null || echo "no-branch")
  local datetime=$(date +%Y%m%d-%H%M)
  local session_name="cc-${repo}-${branch}-${datetime}"

  if [[ -n "$TMUX" ]]; then
    # Already in tmux, just prompt and run
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo "  NEW CLAUDE SESSION"
    echo "  Repo: $repo | Branch: $branch"
    echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    echo ""
    read -p "  Purpose: " session_purpose
    [[ -z "$session_purpose" ]] && session_purpose="General session"
    local escaped_purpose="${session_purpose//\"/\\\"}"
    claude --dangerously-skip-permissions --model opus --append-system-prompt "Session purpose: ${escaped_purpose}"
  else
    # Create tmux session with welcome message and tips
    tmux new-session -s "$session_name" \; send-keys "clear && echo '
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  TMUX SESSION: $session_name
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Quick Tips:
  • Ctrl+B, D           - Detach (leave running in background)
  • Ctrl+B, S           - Session picker (arrow keys + Enter)
  • Ctrl+B, W           - Tree view of all sessions/windows
  • Ctrl+B, [           - Scroll mode (q to exit)
  • /exit then exit     - Quit Claude, then close session

  From another terminal:
  • tmux ls             - List all sessions
  • tmux attach -t NAME - Reattach to specific session
  • tmux choose-session - Interactive session selector

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
' && read -p '  Purpose: ' purpose && claude --dangerously-skip-permissions --model opus --append-system-prompt \"Session purpose: \${purpose:-General session}\"" Enter
  fi
}

resumed() {
  local search="${1:-}"
  local cmd="claude --dangerously-skip-permissions --model opus --resume"
  [[ -n "$search" ]] && cmd="$cmd $search"

  if [[ -n "$TMUX" ]]; then
    eval "$cmd"
  else
    local session_name="cc-resume-$(date +%Y%m%d-%H%M)"
    tmux new-session -s "$session_name" \; send-keys "$cmd" Enter
  fi
}

resumedf() {
  local search="${1:-}"
  local cmd="claude --dangerously-skip-permissions --model opus --resume --fork-session"
  [[ -n "$search" ]] && cmd="$cmd $search"

  if [[ -n "$TMUX" ]]; then
    eval "$cmd"
  else
    local session_name="cc-fork-$(date +%Y%m%d-%H%M)"
    tmux new-session -s "$session_name" \; send-keys "$cmd" Enter
  fi
}
# <<< claude-dotfiles <<<
